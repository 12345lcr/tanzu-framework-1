#@ load("/values.star", "values")
#@ load("@ytt:overlay", "overlay")

#@overlay/match by=overlay.subset({"kind": "Deployment", "metadata": {"name": "vsphere-csi-controller"}})
---
spec:
  template:
    spec:
      containers:
        #@overlay/match by=overlay.subset({"name": "csi-attacher"})
        - image: #@ "{}/{}:{}".format(values.vsphereCSI.CSIAttacherImage.repository, values.vsphereCSI.CSIAttacherImage.path, values.vsphereCSI.CSIAttacherImage.tag)
          #@overlay/match missing_ok=True
          imagePullPolicy: #@ values.vsphereCSI.CSIAttacherImage.pullPolicy
        #@overlay/match by=overlay.subset({"name": "vsphere-csi-controller"})
        - image: #@ "{}/{}:{}".format(values.vsphereCSI.vsphereCSIControllerImage.repository, values.vsphereCSI.vsphereCSIControllerImage.path, values.vsphereCSI.vsphereCSIControllerImage.tag)
          #@overlay/match missing_ok=True
          imagePullPolicy: #@ values.vsphereCSI.vsphereCSIControllerImage.pullPolicy
        #@overlay/match by=overlay.subset({"name": "liveness-probe"})
        - image: #@ "{}/{}:{}".format(values.vsphereCSI.livenessProbeImage.repository, values.vsphereCSI.livenessProbeImage.path, values.vsphereCSI.livenessProbeImage.tag)
          #@overlay/match missing_ok=True
          imagePullPolicy: #@ values.vsphereCSI.livenessProbeImage.pullPolicy
        #@overlay/match by=overlay.subset({"name": "vsphere-syncer"})
        - image: #@ "{}/{}:{}".format(values.vsphereCSI.vsphereSyncerImage.repository, values.vsphereCSI.vsphereSyncerImage.path, values.vsphereCSI.vsphereSyncerImage.tag)
          #@overlay/match missing_ok=True
          imagePullPolicy: #@ values.vsphereCSI.vsphereSyncerImage.pullPolicy
        #@overlay/match by=overlay.subset({"name": "csi-provisioner"})
        - image: #@ "{}/{}:{}".format(values.vsphereCSI.CSIProvisionerImage.repository, values.vsphereCSI.CSIProvisionerImage.path, values.vsphereCSI.CSIProvisionerImage.tag)
          #@overlay/match missing_ok=True
          imagePullPolicy: #@ values.vsphereCSI.CSIProvisionerImage.pullPolicy
