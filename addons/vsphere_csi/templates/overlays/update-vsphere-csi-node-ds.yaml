#@ load("@ytt:data", "data")
#@ load("@ytt:overlay", "overlay")

#@overlay/match by=overlay.subset({"kind": "DaemonSet", "metadata": {"name": "vsphere-csi-node"}})
---
spec:
  template:
    spec:
      containers:
        #@overlay/match by=overlay.subset({"name": "node-driver-registrar"})
        - image: #@ "{}/{}:{}".format(data.values.vsphereCSI.CSINodeDriverRegistrarImage.repository, data.values.vsphereCSI.CSINodeDriverRegistrarImage.path, data.values.vsphereCSI.CSINodeDriverRegistrarImage.tag)
          #@overlay/match missing_ok=True
          imagePullPolicy: #@ data.values.vsphereCSI.CSINodeDriverRegistrarImage.pullPolicy
        #@overlay/match by=overlay.subset({"name": "vsphere-csi-node"})
        - image: #@ "{}/{}:{}".format(data.values.vsphereCSI.vsphereCSIControllerImage.repository, data.values.vsphereCSI.vsphereCSIControllerImage.path, data.values.vsphereCSI.vsphereCSIControllerImage.tag)
          #@overlay/match missing_ok=True
          imagePullPolicy: #@ data.values.vsphereCSI.vsphereCSIControllerImage.pullPolicy
        #@overlay/match by=overlay.subset({"name": "liveness-probe"})
        - image: #@ "{}/{}:{}".format(data.values.vsphereCSI.livenessProbeImage.repository, data.values.vsphereCSI.livenessProbeImage.path, data.values.vsphereCSI.livenessProbeImage.tag)
          #@overlay/match missing_ok=True
          imagePullPolicy: #@ data.values.vsphereCSI.livenessProbeImage.pullPolicy
